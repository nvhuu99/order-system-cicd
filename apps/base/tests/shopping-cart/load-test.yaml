apiVersion: batch/v1
kind: Job
metadata:
  name: user-cart-load-test
  namespace: apps
spec:
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: k6
          image: nvhuu991/order-system-user-cart-k6-test
          imagePullPolicy: Always
          resources:
            requests: { cpu: "200m", memory: "128Mi" }
            limits: { cpu: "200m", memory: "128Mi" }
          envFrom:
            - configMapRef:
                name: apps-env
          env:
            - name: K6_SCRIPT
              value: "user-cart/load-test.js"
            - name: TOTAL_USERS
              value: "3"
            - name: TOTAL_REQUESTS_PER_USER
              value: "10"
            - name: SEED_PRODUCTS_TOTAL
              value: "10"
            - name: MAX_PRODUCT_STOCK
              value: "150"
            - name: CART_ITEM_MAX_QTY
              value: "10"
            - name: CART_MAX_ITEMS
              value: "10"
            - name: SUMMARY_WAIT_FOR_SYNC_SECONDS
              value: "10"
            - name: "INVENTORY_API_ADDR"
              value: inventory-service.apps.svc.cluster.local
            - name: "SHOP_API_ADDR"
              value: shop-service.apps.svc.cluster.local
            - name: DURATION
              value: "10h"
            - name: PRUNE
              value: "false"
            - name: VERBOSE
              value: "false"
