apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: loki
  namespace: monitoring
spec:
  values:
    serviceAccount:
      create: true
      name: loki

    loki:
      image:
        registry: docker.io
        repository: grafana/loki
        tag: 3.5.7
      
      schemaConfig:
        configs:
          - from: "2020-05-15"
            store: tsdb
            object_store: s3
            schema: v13
            index:
              prefix: loki_index_
              period: 24h

      storage_config:
        tsdb_shipper:
          active_index_directory: /loki/index
          cache_location: /loki/index_cache
        aws:
          s3: s3://ap-southeast-7/order-system-monitoring-loki

    ingester:
      persistence:
        enabled: true
        claims:
        - name: data
          size: 5Gi
          storageClass: gp2

    querier:
      persistence: { enabled: true, size: 3Gi, storageClass: gp2 }

    compactor:
      persistence:
        enabled: true
        claims:
        - name: data
          size: 3Gi
          storageClass: gp2

